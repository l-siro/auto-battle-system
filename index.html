<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://unpkg.com/ress/dist/ress.min.css" />
  <style>
    /* CSSスタイルをここに追加 */
    .wrap {
      max-width: 1000px;
      margin: 0 auto;
    }
    #log {
      padding: 10px;
      margin: 10px;
      border-radius: 5px;
      background: rgb(255, 255, 255);
      max-height: 500px;
      overflow-y: scroll;
    }
    .attack_A,
    .attack_B {
      padding: 10px;
      margin: 10px;
      border-radius: 5px;
    }
    .attack_A {
      background: rgb(219, 219, 255);
    }
    .attack_B {
      background: rgb(254, 213, 213);
    }
    .result {
      padding: 10px;
      margin: 10px;
      border-radius: 5px;
      background: rgb(255, 255, 255);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div id="status"></div>
    <hr>
    <div id="log"></div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", function () {
    let characters = [
      { name: "キャラ1", attack: 10, defense: 5, hp: 100, speed: 10, team: 'A', accuracy: 0.8 },
      { name: "キャラ2", attack: 15, defense: 3, hp: 100, speed: 20, team: 'A', accuracy: 0.7 },
      { name: "キャラ3", attack: 12, defense: 4, hp: 100, speed: 15, team: 'B', accuracy: 0.9 },
      { name: "キャラ4", attack: 9, defense: 6, hp: 100, speed: 25, team: 'B', accuracy: 0.75 }
    ];

    characters.sort((a, b) => b.speed - a.speed);

    function addLog(text, className) {
      let log = document.getElementById("log");
      let div = document.createElement("div");
      div.textContent = text;
      div.className = className;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }

    function updateStatus() {
      let status = document.getElementById("status");
      status.innerHTML = '';
      for (let character of characters) {
        let div = document.createElement("div");
        div.textContent = `チーム${character.team}の${character.name}：残りHP ${Math.max(character.hp, 0)}`;
        status.appendChild(div);
      }
    }

    function attack(character, target) {
      if (Math.random() < character.accuracy) {
        let damage = Math.max(0, character.attack - target.defense);
        target.hp -= damage;
        addLog(`チーム${character.team}の${character.name}がチーム${target.team}の${target.name}に${damage}ダメージ！${target.name}の残りHPは${Math.max(target.hp, 0)}。`, "attack_" + character.team);
      } else {
        addLog(`チーム${character.team}の${character.name}の攻撃は外れた！`, "miss_" + character.team);
      }
    }

    function checkAlive(team) {
      return characters.filter(character => character.team === team && character.hp > 0).length > 0;
    }

    // バトルの開始
    function startBattle() {
      let turn = 0;

      function nextTurn() {
        if (checkAlive('A') && checkAlive('B')) {
          let character = characters[turn % characters.length];
          let targets = characters.filter(c => c.team !== character.team && c.hp > 0);
          if (targets.length > 0) {
            let target = targets[Math.floor(Math.random() * targets.length)];
            attack(character, target);
          }
          turn++;
          updateStatus();

          // 次のターンまで一定時間（たとえば500ms）待つ
          setTimeout(nextTurn, 500);
        } else {
          // 勝者の判定
          if (checkAlive('A')) {
            addLog('チームAの勝利！', 'result');
          } else {
            addLog('チームBの勝利！', 'result');
          }
        }
      }

      nextTurn();
    }

    // ステータスの初期表示とバトルの開始
    updateStatus();
    startBattle();

  });

  </script>
</body>
</html>
